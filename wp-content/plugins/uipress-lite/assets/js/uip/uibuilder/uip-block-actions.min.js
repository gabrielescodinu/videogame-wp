const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;export function moduleData(){return{props:{block:Object,parentList:Array,currentIndex:Number,smallIcons:Boolean,reverse:Boolean,disabled:Array,expanded:Boolean,closeActions:Function},data:function(){return{option:"",strings:{savePattern:__("Save pattern","uipress-lite"),settings:__("Settings","uipress-lite"),style:__("Style","uipress-lite"),copy:__("Copy","uipress-lite"),paste:__("Paste","uipress-lite"),advanced:__("Advanced","uipress-lite"),duplicate:__("Duplicate","uipress-lite"),syncPattern:__("Sync pattern","uipress-lite"),delete:__("Delete","uipress-lite")}}},inject:{uipData:{from:"uipData"},router:{from:"router"},uipress:{from:"uipress"},uiTemplate:{from:"uiTemplate"},saveTemplate:{from:"saveTemplate",default:()=>({name:"save not ready"})},openModal:{from:"openModal"}},watch:{},computed:{returnDisabled(){return Array.isArray(this.disabled)?this.disabled:[]}},mounted:function(){},methods:{openSettings(e){let i=this.$route.params.templateID;this.router.push({path:"/uibuilder/"+i+"/settings/blocks/"+e,query:{...this.$route.query,section:"settings"}})},openStyles(e){let i=this.$route.params.templateID;this.router.push({path:"/uibuilder/"+i+"/settings/blocks/"+e,query:{...this.$route.query,section:"style"}})},openAdvanced(e){let i=this.$route.params.templateID;this.router.push({path:"/uibuilder/"+i+"/settings/blocks/"+e,query:{...this.$route.query,section:"advanced"}})},duplicateBlock(e){let i,t=JSON.parse(JSON.stringify(this.uiTemplate.content)),s=this;s.uipress.getParentByUID(s.uiTemplate.content,e.uid).then(n=>{if(n){i=n;let l=Object.assign({},e);l.uid=this.uipress.createUID(),l.options=[],l.settings=JSON.parse(JSON.stringify(l.settings)),l.content&&(l.content=this.duplicateChildren(l.content));let p=i.findIndex(i=>i.uid===e.uid);i.splice(p,0,l);let a=JSON.parse(JSON.stringify(this.uiTemplate.content));s.uipress.logHistoryChange(e.name+__(" duplicated","uipress-lite"),t,a),s.uipress.notify(e.name+" "+__(" duplicated","uipress-lite"),"","success",!0)}})},pasteBlock(){if(!this.block.content)return;if(!this.uiTemplate.copied)return;let e=JSON.parse(JSON.stringify(this.uiTemplate.content)),i=Object.assign({},this.uiTemplate.copied);i.uid=this.uipress.createUID(),i.options=[],i.settings=JSON.parse(JSON.stringify(i.settings)),i.content&&(i.content=this.duplicateChildren(i.content)),this.block.content.splice(this.block.content.length,0,i);let t=JSON.parse(JSON.stringify(this.uiTemplate.content));this.uipress.logHistoryChange(this.block.name+__(" pasted","uipress-lite"),e,t),this.uipress.notify(this.block.name+" "+__(" pasted","uipress-lite"),"","success",!0),this.uiTemplate.copied=!1,this.closeActions()},duplicateChildren(e){let i=[];for(let t of e){let e=Object.assign({},t);e.uid=this.uipress.createUID(),e.settings=JSON.parse(JSON.stringify(e.settings)),e.content&&(e.content=this.duplicateChildren(e.content)),i.push(e)}return i},removeBlock(e){let i=this;i.uipress.deleteByUID(i.uiTemplate.content,e.uid).then(t=>{if(t){i.uipress.notify(e.name+" "+__("block deleted","uipress-lite"),"","default",!0);let t=JSON.parse(JSON.stringify(i.uiTemplate.content));if(i.uipress.logHistoryChange(e.name+" "+__("block deleted","uipress-lite"),t,!1),i.$route.params.uid&&i.$route.params.uid==e.uid){let e=i.$route.params.templateID;i.router.push("/uibuilder/"+e+"/")}}})},confirmSyncPattern(e){let i=this;this.uipress.confirm(__("Sync pattern?","uipress-lite"),__("This will update the pattern template and will sync this pattern's changes accross all templates using the same pattern","uipress-lite"),__("Sync patern","uipress-lite")).then(t=>{if(t){let t=JSON.parse(JSON.stringify(i.uiTemplate.content));i.uipress.cleanTemplate(t).then(s=>{i.uipress.saveTemplate(t).then(t=>{let s=i.uipress.notify(__("Pattern sync in progress","uipress-lite"),"","default",!1,!0);i.uipress.blockHouseKeeping(e).then(e=>{i.syncUiPatternDB(e,s)})})})}})},syncUiPatternDB(e,i){let t=this,s=new FormData,n=JSON.stringify(e,(e,i)=>"true"===i?"uiptrue":!0===i?"uiptrue":"false"===i?"uipfalse":!1===i?"uipfalse":""===i?"uipblank":i);s.append("action","uip_sync_ui_pattern"),s.append("security",uip_ajax.security),s.append("pattern",n),s.append("patternID",e.patternID),s.append("templateID",t.$route.params.templateID),t.uipress.callServer(uip_ajax.ajax_url,s).then(s=>{s.error&&(t.uipress.notify(s.message,"uipress-lite","","error",!0),t.saving=!1),s.success&&(s.newPattern&&(e.patternID=JSON.parse(JSON.stringify(s.newPattern))),s.newTemplate&&(t.uiTemplate.content=s.newTemplate),t.uiTemplate.patterns=s.patterns,t.uipress.notify(__("Pattern succesfully synced","uipress-lite"),"","success",!0),t.uipress.destroy_notification(i))})},ifEnabled(e){return!this.returnDisabled.includes(e)},canPaste(){return!(!this.block.content||!this.uiTemplate.copied)},copyBlock(e){this.uiTemplate.copied=e,this.uipress.notify(__("Block copied","uipress-lite"),"","success",!0)}},template:'\n\t<div v-if="!expanded" class="uip-flex uip-gap-xxs" :class="[{\'uip-text-l\' : !smallIcons},{\'uip-flex-reverse\' : reverse}]">\n\t  <div v-if="ifEnabled(\'settings\')" class="uip-icon uip-link-muted"  @click="openSettings(block.uid)">tune</div>\n\t  <div v-if="ifEnabled(\'duplicate\')" class="uip-icon uip-link-muted" @click="duplicateBlock(block)">content_copy</div>\n    <div v-if="ifEnabled(\'pattern\')" class="uip-icon uip-link-muted" @click="openModal(\'saveaspattern\', strings.savePattern, {blockitem: block})">bookmark_add</div>\n\t  <div v-if="block.patternID && ifEnabled(\'sync\')" class="uip-icon uip-link-muted" @click="confirmSyncPattern(block)">sync</div>\n\t  <div class="uip-border-left"></div>\n\t  <div v-if="ifEnabled(\'delete\')"  class="uip-icon uip-link-danger" @click="removeBlock(block)">delete</div>\n\t</div>\n  \n  <div v-else>\n  \n    <div class="uip-flex uip-flex-column uip-row-gap-xs uip-padding-xs uip-border-bottom">\n    \n      <div class="uip-flex uip-flex-row uip-flex-center uip-gap-xs">\n        <div class="uip-text-bold">{{block.name}}</div>\n      </div> \n    \n    </div>\n    \n    <div class="uip-flex uip-flex-column uip-row-gap-xxs uip-padding-xs uip-border-bottom">\n  \n      <div v-if="ifEnabled(\'settings\')" class="uip-flex uip-flex-row uip-flex-center uip-gap-xs uip-link-muted" @click="openSettings(block.uid);closeActions()">\n        <div class="uip-icon">tune</div>\n        <div class="">{{strings.settings}}</div>\n      </div> \n      \n      <div v-if="ifEnabled(\'settings\')" class="uip-flex uip-flex-row uip-flex-center uip-gap-xs uip-link-muted" @click="openStyles(block.uid);closeActions()">\n        <div class="uip-icon">palette</div>\n        <div class="">{{strings.style}}</div>\n      </div>  \n      \n      <div v-if="ifEnabled(\'settings\')" class="uip-flex uip-flex-row uip-flex-center uip-gap-xs uip-link-muted" @click="openAdvanced(block.uid);closeActions()">\n        <div class="uip-icon">code</div>\n        <div class="">{{strings.advanced}}</div>\n      </div>  \n      \n    </div>\n    \n    <div class="uip-flex uip-flex-column uip-row-gap-xxs uip-padding-xs uip-border-bottom"> \n    \n      <div v-if="ifEnabled(\'duplicate\')" class="uip-flex uip-flex-row uip-flex-center uip-gap-xs uip-link-muted" @click="copyBlock(block);">\n        <div class="uip-icon">file_copy</div>\n        <div class="">{{strings.copy}}</div>\n      </div>  \n      \n      <div :class="canPaste() ? \'\' : \'uip-link-disabled\'" class="uip-flex uip-flex-row uip-flex-center uip-gap-xs uip-link-muted" @click="pasteBlock();">\n        <div class="uip-icon">content_paste</div>\n        <div class="">{{strings.paste}}</div>\n      </div> \n      \n      <div v-if="ifEnabled(\'duplicate\')" class="uip-flex uip-flex-row uip-flex-center uip-gap-xs uip-link-muted" @click="duplicateBlock(block);closeActions()">\n        <div class="uip-icon">content_copy</div>\n        <div class="">{{strings.duplicate}}</div>\n      </div>  \n      \n      <div v-if="ifEnabled(\'pattern\')" class="uip-flex uip-flex-row uip-flex-center uip-gap-xs uip-link-muted" @click="openModal(\'saveaspattern\', strings.savePattern, {blockitem: block});closeActions()">  \n        <div class="uip-icon">bookmark_add</div>\n        <div class="">{{strings.savePattern}}</div>\n      </div>\n      \n      <div v-if="block.patternID && ifEnabled(\'sync\')" class="uip-flex uip-flex-center uip-flex-row uip-gap-xs uip-link-muted" @click="confirmSyncPattern(block);closeActions()">  \n        <div class="uip-icon">sync</div>\n        <div class="">{{strings.syncPattern}}</div>\n      </div>  \n      \n    </div>\n    \n    <div class="uip-flex uip-flex-column uip-row-gap-xxs uip-padding-xs">\n    \n      <div v-if="ifEnabled(\'delete\')" class="uip-flex uip-flex-row uip-flex-center uip-gap-xs uip-link-danger" @click="removeBlock(block);closeActions()">\n        <div class="uip-icon">delete</div>\n        <div class="">{{strings.delete}}</div>\n      </div>  \n    \n    </div>\n  \n  </div>\n  \n  '}};